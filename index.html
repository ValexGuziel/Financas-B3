<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Radar B3 - InvestApp</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    @keyframes ticker {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-50%);
      }
    }

    .ticker-content {
      display: flex;
      animation: ticker 40s linear infinite;
    }

    .card {
      background: #1e293b;
      border-radius: 12px;
      border: 1px solid #334155;
    }

    /* Ajuste para o Footer */
    body {
      padding-bottom: 90px;
    }

    .nav-bar {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      border-top: 1px solid #334155;
    }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      color: #94a3b8;
      font-size: 10px;
      font-weight: 600;
    }

    .nav-item.active {
      color: #3b82f6;
    }
  </style>
</head>

<body class="bg-slate-950 text-white font-sans min-h-screen">

  <div class="bg-black border-b border-slate-800 py-3 sticky top-0 z-40">
    <div class="overflow-hidden whitespace-nowrap flex">
      <div class="ticker-content" id="ticker-data">
        <span class="px-10 text-slate-500 font-bold uppercase text-xs">Carregando dados da bolsa...</span>
      </div>
    </div>
  </div>

  <section class="bg-slate-900/50 p-6 border-b border-slate-800">
    <div class="container mx-auto max-w-2xl">
      <div class="flex gap-2">
        <input type="text" id="search-ticker" placeholder="BUSCAR ATIVO..."
          class="w-full px-4 py-3 rounded-xl bg-slate-800 border border-slate-700 text-blue-400 font-black uppercase outline-none focus:ring-2 focus:ring-blue-500">
        <button onclick="searchStock()" class="bg-blue-600 px-6 rounded-xl font-black">OK</button>
      </div>
      <div id="search-result" class="mt-4"></div>
    </div>
  </section>

  <main class="container mx-auto p-4 md:p-8">
    <div class="grid lg:grid-cols-2 gap-8">
      <section>
        <h3 class="text-green-500 font-black mb-4 flex items-center gap-2 uppercase text-xs italic">▲ 10 Maiores Altas
        </h3>
        <div id="highs-list" class="space-y-3"></div>
      </section>
      <section>
        <h3 class="text-red-500 font-black mb-4 flex items-center gap-2 uppercase text-xs italic">▼ 10 Maiores Baixas
        </h3>
        <div id="lows-list" class="space-y-3"></div>
      </section>
    </div>
  </main>

  <nav class="nav-bar fixed bottom-0 left-0 right-0 h-20 flex z-50 px-2">
    <a href="#" class="nav-item active">
      <i data-lucide="layout-dashboard"></i>
      <span>Radar</span>
    </a>
    <a href="#" class="nav-item">
      <i data-lucide="wallet"></i>
      <span>Carteira</span>
    </a>
    <a href="#" class="nav-item">
      <i data-lucide="bar-chart-3"></i>
      <span>Ativos</span>
    </a>
    <a href="#" class="nav-item">
      <i data-lucide="trending-down"></i>
      <span>Gastos</span>
    </a>
    <a href="#" class="nav-item">
      <i data-lucide="pie-chart"></i>
      <span>Resumo</span>
    </a>
  </nav>

  <script>
    const API_TOKEN = 'SUA_CHAVE_AQUI';

    // Inicializa os ícones Lucide
    lucide.createIcons();

    async function updateTicker() {
      try {
        const res = await fetch(`https://brapi.dev/api/quote/%5EBVSP%2CUSDBRL%2CEURBRL%2CIFIX%3DX?token=${sWQ9WUsu9XVMkeXC8SZGVB}`);
        const data = await res.json();
        const find = (s) => data.results.find(r => r.symbol.includes(s)) || { regularMarketPrice: 0, regularMarketChangePercent: 0 };

        const indices = [
          { n: 'SELIC', v: '10,75%', c: 0 },
          { n: 'IPCA', v: '4,51%', c: 0 },
          { n: 'IBOV', v: find('BVSP').regularMarketPrice.toLocaleString(), c: find('BVSP').regularMarketChangePercent },
          { n: 'DÓLAR', v: `R$ ${find('USD').regularMarketPrice.toFixed(2)}`, c: find('USD').regularMarketChangePercent },
          { n: 'EURO', v: `R$ ${find('EUR').regularMarketPrice.toFixed(2)}`, c: find('EUR').regularMarketChangePercent },
          { n: 'IFIX', v: find('IFIX').regularMarketPrice.toFixed(0), c: find('IFIX').regularMarketChangePercent }
        ];

        const html = indices.map(i => `
                    <div class="flex items-center gap-2 px-8 border-r border-slate-900">
                        <span class="text-[10px] text-slate-500 font-bold">${i.n}</span>
                        <span class="text-sm font-black">${i.v}</span>
                        ${i.c !== 0 ? `<span class="text-[10px] font-bold ${i.c >= 0 ? 'text-green-500' : 'text-red-500'}">${i.c >= 0 ? '+' : ''}${i.c.toFixed(2)}%</span>` : ''}
                    </div>
                `).join('');
        document.getElementById('ticker-data').innerHTML = html + html;
      } catch (e) { }
    }

    async function fetchMarketData() {
      try {
        const res = await fetch(`https://brapi.dev/api/quote/list?token=${API_TOKEN}`);
        const data = await res.json();
        const sorted = data.stocks.filter(s => s.change !== null && s.volume > 100000).sort((a, b) => b.change - a.change);
        render('highs-list', sorted.slice(0, 10), '#22c55e');
        render('lows-list', [...sorted].reverse().slice(0, 10), '#ef4444');
      } catch (e) { }
    }

    function render(id, list, color) {
      const container = document.getElementById(id);
      container.innerHTML = list.map((s, i) => `
                <div class="card p-4 flex justify-between items-center">
                    <div class="w-16 font-black text-sm">${s.stock}</div>
                    <div class="flex-1 h-8 mx-4"><canvas id="c-${id}-${i}"></canvas></div>
                    <div class="text-right">
                        <p class="font-bold text-xs text-slate-300">R$ ${s.close.toFixed(2)}</p>
                        <p class="text-[10px] font-black ${s.change >= 0 ? 'text-green-400' : 'text-red-400'}">${s.change.toFixed(2)}%</p>
                    </div>
                </div>
            `).join('');
      list.forEach((s, i) => {
        new Chart(document.getElementById(`c-${id}-${i}`).getContext('2d'), {
          type: 'line',
          data: { labels: [1, 2, 3, 4, 5, 6], datasets: [{ data: s.change > 0 ? [10, 12, 11, 20, 18, 25] : [25, 18, 20, 11, 12, 10], borderColor: color, borderWidth: 1.5, pointRadius: 0, fill: false, tension: 0.4 }] },
          options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
        });
      });
    }

    async function searchStock() {
      const t = document.getElementById('search-ticker').value.toUpperCase();
      if (!t) return;
      try {
        const res = await fetch(`https://brapi.dev/api/quote/${t}?token=${API_TOKEN}`);
        const d = await res.json();
        const s = d.results[0];
        document.getElementById('search-result').innerHTML = `
                    <div class="card p-5 border-blue-500 shadow-xl">
                        <div class="flex justify-between items-center">
                            <div><p class="text-xl font-black">${s.symbol}</p><p class="text-[10px] text-slate-500 uppercase">${s.longName}</p></div>
                            <div class="text-right">
                                <p class="text-2xl font-black">R$ ${s.regularMarketPrice.toFixed(2)}</p>
                                <p class="font-bold ${s.regularMarketChangePercent >= 0 ? 'text-green-500' : 'text-red-400'}">${s.regularMarketChangePercent.toFixed(2)}%</p>
                            </div>
                        </div>
                    </div>`;
      } catch (e) { document.getElementById('search-result').innerHTML = "<p class='text-red-500'>Erro.</p>"; }
    }

    updateTicker();
    fetchMarketData();
    setInterval(updateTicker, 60000);
    setInterval(fetchMarketData, 60000);
  </script>
</body>

</html>